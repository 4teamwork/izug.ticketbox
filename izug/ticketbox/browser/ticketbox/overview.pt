
    <div i18n:domain="izug.ticketbox"
		tal:define="priorities context/getAvailablePriorities;
              		areas context/getAvailableAreas;
                    releases context/getAvailableReleases;
                    states context/getAvailableStates;
                    varieties context/getAvailableVarieties;
                    responsibles context/assignable_users
                    ">

      <table class="ticketbox-overview invisible">
			<tr>
				<td>
			
					<div id="tickets-by-responsible" class="ticketbox-quick-search-box">
			          <h3 i18n:translate="label_heading_by_responsible">By responsible </h3>
						
			          	<tal:areas repeat="responsible responsibles">
			
			                <div tal:define="responsibleId python:responsible[0];
							user python:context.portal_membership.getMemberById(responsibleId);
                                                        responsibleTitle python: user and user.getProperty('fullname', responsibleId) or responsible[1];
							tickets python:view.getFilteredTickets(responsible=responsibleId)
											">
			                <a tal:attributes="href string:${context/absolute_url}?searchkey=responsible&searchvalue=${responsibleId}"
			                   tal:content="responsibleTitle" /> (<span tal:replace="python:len(tickets)" />)
			               </div>
			              </tal:areas>
			      </div>

				</td>
				<td>
					<div tal:condition="states" id="tickets-by-state" class="ticketbox-quick-search-box">
				          <h3 i18n:translate="label_heading_by_states">By states</h3>
			
				              <tal:areas repeat="state states">
				                <div tal:define="stateId state/id;
												stateTitle state/title;
												tickets python:view.getFilteredTickets(state=stateId)
												">
				                <a tal:attributes="href string:${context/absolute_url}?searchkey=state&amp;searchvalue=${stateId}"
				                   tal:content="stateTitle" /> (<span tal:replace="python:len(tickets)" />)
				               </div>
				              </tal:areas>
			
				      </div>
				      
                      	<div tal:condition="varieties" id="tickets-by-variety" class="ticketbox-quick-search-box">
                      	    <br />
      				          <h3 i18n:translate="label_heading_by_varieties">By varieties</h3>

      				              <tal:areas repeat="variety varieties">
                        <!--In a existing old (created before this commit) ticketbox we need to access at leas one times
                            on his vars (ex. edit the ticketbox). If we don't do that, 'varieties' contains: [{},] 
                            so it try to iter over this empty map an try to access to the attribute id which dosen't exist.-->
						  <tal:fix condition="variety/id|nothing">
      				                <div tal:define="varietyId variety/id;
      												varietyTitle variety/title;
      												tickets python:view.getFilteredTickets(variety=varietyId)
      												">
      				                <a tal:attributes="href string:${context/absolute_url}?searchkey=variety&amp;searchvalue=${varietyId}"
      				                   tal:content="varietyTitle" /> (<span tal:replace="python:len(tickets)" />)
      				               </div>
						</tal:fix>
      				              </tal:areas>

      				      </div>
				</td>
				<td>
						<div tal:condition="releases" id="tickets-by-release" class="ticketbox-quick-search-box">
				          <h3 i18n:translate="label_heading_by_release">By release</h3>
				              <tal:areas repeat="release releases">
			                	<div tal:define="releaseId release/id;
												releaseTitle release/title;
												tickets python:view.getFilteredTickets(release=releaseId)
												">
				                <a tal:attributes="href string:${context/absolute_url}?searchkey=release&searchvalue=${releaseId}"
				                   tal:content="releaseTitle" /> (<span tal:replace="python:len(tickets)" />)
				               </div>
				              </tal:areas>
				           </div>
			           <div tal:condition="releases" id="tickets-by-watched-release" class="ticketbox-quick-search-box">
						    <br>
				          <h3 i18n:translate="label_heading_by_watched_release">Watched in</h3>
				              <tal:areas repeat="release releases">
			                	<div tal:define="releaseId release/id;
												releaseTitle release/title;
												tickets python:view.getFilteredTickets(watchedRelease=releaseId)
												">
				                <a tal:attributes="href string:${context/absolute_url}?searchkey=watchedRelease&searchvalue=${releaseId}"
				                   tal:content="releaseTitle" /> (<span tal:replace="python:len(tickets)" />)
				               </div>
				              </tal:areas>
				           </div>
   						
				</td>
				<td>
				       
                                         <div tal:condition="priorities" id="tickets-by-priority" class="ticketbox-quick-search-box">
				          <h3 i18n:translate="label_heading_by_severities">By priority</h3>

				              <tal:areas repeat="priority priorities">
				                <div tal:define="priorityId priority/id;
						                priorityTitle priority/title;
								tickets python:view.getFilteredTickets(priority=priorityId)

												">
				                <a tal:attributes="href string:${context/absolute_url}?searchkey=priority&searchvalue=${priorityId}"
				                   tal:content="priorityTitle" /> (<span tal:replace="python:len(tickets)" />)
				               </div>
				              </tal:areas>
			
                                      </div>

                                      <div tal:condition="areas" id="tickets-by-area" class="ticketbox-quick-search-box">
                                        <br/>
                                        <h3 i18n:translate="label_heading_by_area">By area</h3>
                            
                                            <tal:areas repeat="area areas">
                                              <div tal:define="areaId area/id;
                                                              areaTitle area/title;
                                                              tickets python:view.getFilteredTickets(area=areaId) ">
                                                <a tal:attributes="href string:${context/absolute_url}?searchkey=area&searchvalue=${areaId}"
                                                   tal:content="areaTitle" /> (<span tal:replace="python:len(tickets)" />)
                                              </div>
                                            </tal:areas>
                               
                                       </div>
				</td>
			</tr>
		</table>











      <div class="visualClear"><!----></div>


	<tal:translation>
	  <form name="tabbedview_form"
	        method="post"
	        action="folder_object"
	        tal:attributes="action context/absolute_url"
	        tal:define="Batch python:modules['Products.CMFPlone'].Batch;
	        			b_size python:50;
	        			b_size request/b_size | b_size;
	        			b_size python: type(b_size) == type([]) and b_size[-1] or b_size;
	        			b_start python:0;b_start request/b_start | b_start;
	        			b_range python: b_start==0 and 5 or 3;
	        			batch python:Batch(view.contents, int(b_size), int(b_start), orphan=1,pagerange=int(b_range));"
	        >

	    <input type="hidden" name="orig_template" tal:attributes="value string:${here/absolute_url}/#${view/view_name}" />

	    <tal:cond tal:condition="view/contents">
	        <div metal:use-macro="here/batch_macros/macros/navigation" tal:condition="request/show" />
	        <div tal:content="structure view/render_listing" />
	    </tal:cond>

	    <p tal:condition="not: view/contents">
	        
	    </p>

	  </form>

	<script type="text/javascript">
		jq(function(){
			var $links = jq('.ticketbox-quick-search-box a');
			$links.bind('click', function(e){
			  e.preventDefault();
			  $this = jq(this);

				<!-- TODO: alle parameter so flushen -->
			  tabbedview.flush_params("state");
			  tabbedview.flush_params("responsible");
			  tabbedview.flush_params("area");
			  tabbedview.flush_params("variety");
			  tabbedview.flush_params("priority");
   			  tabbedview.flush_params("release");
   			  tabbedview.flush_params("watchedRelease");

			  params =jq.find_param($this.attr('href'));
			  params_searchvalue = params['searchvalue']
			  params_searchkey = params['searchkey']
			  tabbedview.param(params_searchkey, params_searchvalue);
			  tabbedview.reload_view();
			});

		});

	</script>

	</tal:translation>


    </div>




